●システム統合最後のボトルネック 基幹系DBの集約は既に現実のものに

ITインフラの統合と集約、効率化が技術的にこなれてきたことから、多くの企業で全社共通基盤の構想が注目されつつあるが、こうした基盤作りで取り残されがちなのが、高いパフォーマンスが要求されるシステムのDBだ。一般的な仮想化技術のアプローチでは不可能であった性能要件も、データベースを熟知したベンダーが提供する方法で技術的な課題は解決できる。既に基幹系データベースの統合・集約を実現している企業も多数出現してきているいま、そのトレンド、技術背景に注目して取材した。

　コスト効率化や柔軟性の高い業務改革を目指すクラウドが注目され、企業内のシステムでも仮想化によるサーバー統合が進んできている。しかし、日本オラクル 製品戦略事業統括本部 データベースコア製品推進本部 シニアプロダクトラインマネジャーの岩崎護氏は、「ハイパーバイザー型の仮想化でハードウェア統合を行っても、データベース（以下、DB）サーバーの統合まで行うケースは少ない」と話す。効率的でコストメリットのあるDB統合のためには、どのようなアプローチとテクノロジが必要になってくるのだろうか（本稿末のアンケートに回答すると、より詳細な資料を得られる）。

●課題が多く進まない、仮想化技術によるDB統合

　サーバーやアプリケーションを仮想化技術で統合・集約するのであれば、DBサーバーも仮想化して統合し、仮想化のメリットを広げていくことが考えられる。しかし、岩崎氏は「通常のサーバー仮想化で採用している仮想化技術によるDB統合は、性能、可用性、運用の面で、要求通りのシステム要件を満たせないことが多い。一般的な仮想化技術で、足りないところを補うためにハードウェアやソフトウェアで対策を施せば、結果的にコスト高となってしまうこともある」と注意を促す。

　DB仮想化を企業のシステム部が検討しても、最終的には統合を諦めてしまうケースが多い。というのも、DBに求める性能要件を通常の仮想化技術では保証し切れないために、実際の実装を担当するSIer側が推奨しないためだ。また、DB仮想化に踏み切っても、I/O性能を確保するためにハイエンドなストレージ製品を利用することになり、コストが膨大になってしまうこともある。

　日本オラクル 製品戦略事業統括本部 データベースコア製品推進本部 プロダクトラインマネジャーの山本祐介氏も次のように話す。

　「多くのトランザクションが発生しないようなシステムでは仮想化も可能ですが、ミッションクリティカルなシステムや性能を重視するシステムでのDB仮想化は現実的ではない。スモールスタートで始めたときには問題にならなくても、拡張していくと、I/O性能の高い高価なストレージを増設せざるを得ず、結果、コストが膨大になってしまい後悔したという話はよく聞く」

　可用性の問題では、例えば、仮想化製品には仮想化製品特有のマイグレーション技術があり、これらの技術はOSやアプリケーションのマイグレーションには適しているものの、DBのトランザクション保証などを詳細に行うことができない。このため、ミッションクリティカルなシステムで利用することは非常に危険だ。また、1つのシステムがストップすると他のシステムにも影響を与えるため、それまで行っていた処理を引き継ぐことができないということも大きな問題だ。

　加えて、運用面では、仮想化によって集約率を高めてもDBインスタンス数が減るわけではないので物理DBと同様の運用管理が必要となり、むしろ仮想化により仮想マシンやDBインスタンスの乱立につながるという課題に直面している情報システム部門も少なくない。

●DBパフォーマンスを生かした統合集約を考える

　ただ、マシンを仮想イメージにして管理するのでは不十分、DBの挙動、求められる性能を理解した上で、統合集約というITトレンドを吸収するための技術が求められる。

　仮想化によるDB統合が難しいのであれば、どのようなソリューションでDBを集約し、コストメリットや性能向上を目指せばよいのだろうか。岩崎氏は、オラクルが提供する「Oracle Exadata Database Machine」（以下、Exadata）や「Oracle Database Appliance」（以下、ODA）を利用することを勧めている。

　ExadataやODAは、Engineered Systemsと呼ばれる製品群で、ハードウェアとソフトウェアを最適な設計で組み合わせることでコストメリットと性能を両立させている。

　DBの性能面の課題を解決するため、ExadataではRACやExadata Storage Serverによってリソースを制御し、性能を保ったままDB統合を行えるようになっている。

　一般的な仮想化製品は、OSのリソースしか制御せず、DBの処理やトランザクションがどのようなものかまでを把握できないため、バッチ処理のトランザクションがI/Oを占有してしまい、OLTP（OnLine transaction processing）処理に影響してしまう可能性がある。

　一方、「データベースマシン」として開発されたExadataでは、DBリソースやI/Oリソース、ネットワークリソースを制御できるように設計されているため、OLTPを優先させて他のI/Oに阻害されないようにできる。加えて、高速なInfiniBand（40Gbps×2）や高性能なストレージのパフォーマンスそのものの優位性もある。

　また、SQLクエリをストレージ領域の中で分散処理し、最小限のデータ量のみをDBに返すことで、I/O負荷を低減する機構であるSmart Scan、SQLの絞り込み条件に合うデータだけを選択的にスキャンするStorage Index、さらにI/O高速化とDB負荷低減を実現するSmart Flash Cashなど、性能向上をサポートする機能が多数搭載されていることも見逃せない。

　一方、DB統合の容易性という観点では、Oracle Database 12cで提供されているOracle Multitenantというオプションで、複数の仮想的なプラガブルDBをマルチテナント・コンテナDBという大きなDBに搭載し、アプリケーションを変更することなしにDB統合が行えるようになったことが挙げられる。これによって、サーバー1台当たりのDBを高密度に集約でき、多数のDBのバックアップ、迅速なプロビジョニングやマイグレーションが可能となっている。

●可用性や運用性を担保するために

　Exadataでは、Oracle Maximum Availability Architecture（MAA）で統一された高可用性テクノロジが採用されており、RAC、Active Data Guard、ASM（Automatic Storage Management）といった機能で可用性の問題を解決することが可能だ。前述のように仮想化製品などでは障害時に引き継ぐことができない処理も、RACやData GuardでしっかりとDB側の処理として認識することによって、スムーズな復旧を行うことができる。また、ストレージ側ではASMで冗長化が行われ、万が一破損した場合も正常なデータを自動的にリカバリする機能を持っている。

　岩崎氏は、「仮想化によるDB統合は、やはり統合DBとしての信頼性に欠ける部分がある」と話し、統一されたアーキテクチャで運用管理の手間も低減できると説明する。「Exadataなどでは、統合して手法をそろえることで、サーバーやストレージの冗長化のルールやDRの仕組みなどを標準化でき、後から追加導入しても同じ仕組みと基盤でDBが動くことになる。これによって、障害時の対応がスムーズになり、統一した信頼性の中で運用管理できる」。

　また、ExadataやODAでは、オラクル製品全てを統合管理できる「Oracle Enterprise Manager 12c」（以下、Oracle EM）が採用されており、ブラウザーベースで視覚的にハードウェアやソフトウェア、クラウドなどを統合制御することが可能だ。

　日本オラクル 製品戦略事業統括本部 データベースコア製品推進本部 シニアプロダクトラインマネジャーの平井克人氏は、「Oracle EMは、オラクル製品に特化した深い監視・管理ができる点が強みであり、DBの稼働状況を定期的に取得し、性能劣化などの問題があれば、問題の原因特定⇒解決方法のアドバイスを提供してくれるDB管理者を支援する管理フレームワークである。またExadataであれば、DBだけではなく、サーバーやストレージ、InfiniBandネットワークの稼働状況など、Exadataを構成するハードウェアの管理もできる」とOracle EMについての特長を説明する。続けて、「最近はExadataにDBを統合されるお客さまが増えているが、アプリケーション改修に伴うDBのテーブルや索引などの構成変更管理やDBへのパッチ適用といった作業に負荷が掛かっているケースが多い。これら作業においてもOracle EMでは簡素化・自動化する機能を備えており管理者の負荷軽減が可能である」と大規模なDB統合環境においても、Oracle EMによって運用管理が容易になることを説明する。

　ExadataとODAは、「システムの規模や利用範囲によって使い分けて選べる」と話す山本氏は、「ODAは一般的な性能を極めて高いコストパフォーマンスで実現できるので、中堅・中小の規模のシステムにはODAが最適。一方で大量のトランザクションや大規模なデータを高速に処理する必要があるミッションクリティカルな要件ではExadataが最適となる」と説明。岩崎氏も「他のDBをお使いの方が初めてオラクル製品をお使いになるのであれば、ODAで性能と可用性の高さ、運用管理の容易さを実感していただき、その後の拡張でミッションクリティカルな用途や要件に適用する場合はExadataを採用していただきたい」と話す。

　「DB統合は、DBを意識したテクノロジを使わなければ成功しない」と岩崎氏が言うように、オラクルでは、独自の高いテクノロジでDB統合を可能にし、性能、可用性、運用性を向上させたEngineered Systemsを提供している。次回の記事では、実際にオラクルのテクノロジを利用した企業がどのようにDB統合を果たし、コストや機能などでどのようなメリットを享受できたのかを事例をベースに読み解いていきたい。

